<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RE/MAX - Find Your Future Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


<!--Google Maps API-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDIYrxxQCyWzaeLr1iRNoZOhzAaXc7725Y&callback=initMap&libraries=geometry&v=weekly" async defer></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="home">
    <header class="py-3">
      <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"><img src="image/logo.png" alt="Bootstrap" height="50"></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="#">Properties</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Brokers</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Blog</a>
              </li>
              <li class="nav-item dropdown">
                <button class="btn btn-danger dropdown-toggle nav-link p-2" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                  My Re/Max
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <li><a class="dropdown-item" href="login.html">Log in</a></li>
                  <li><a class="dropdown-item" href="register.html">Register</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">FR</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <section class="hero-section">
        <div class="container">
          <h1 class="mb-30">One click away from your future home!</h1>
          <p class="mb-5">Find the property of your dreams</p>
          <!-- TODO: NEED LOTS OF JS -->
          <div class="search-box bg-white p-4 rounded shadow mb-5">
            <ul class="nav nav-pills mb-3">
              <li class="nav-item">
                <a class="nav-link active" href="#">Residential</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Commercial</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Collection</a>
              </li>
            </ul>
            <form class="row g-3">
              <div class="col-md-4">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search by region, city, neighborhood, street, MLS"
                />
              </div>
              <div class="col-md-2">
                <select class="form-select">
                  <option selected>For sale</option>
                  <option>For rent</option>
                </select>
              </div>
              <!-- FIXME: TRANG - slider bar from 0 - unlimited + display + apply button -->
              <div class="col-md-2">
                <select class="form-select">
                  <option selected>Price</option>
                </select>
              </div>
              <!-- FIXME: TRANG - drop down with checkbox + apply button -->
              <div class="col-md-2">
                <select class="form-select">
                  <option selected>Property</option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="submit" class="btn btn-danger w-100">Find</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- MAP API SECTION -->

      <!--MAP WILL DISPLAY ALL LISTED PROPERTIES, 1 PIN PER PROPERTY, AGGLUTINATE IF >5 PROPERTIES-->
      <!--if session active (buyer or realtor) display a) user location from postal code in profile b) properties nearby c) distance between both e.g. 5.6km from you: -->
      
      <section class="latest-properties py-5">
        <div class="container">
          <div class="bg-white p-4 rounded shadow">

<!--SOURCE: https://www.geodatasource.com/resources/tutorials/how-to-calculate-the-distance-between-2-locations-using-php/ -->
<!--SOURCE: https://developers.google.com/maps/documentation/geocoding/overview-->

<!--displaying maps-->
<div id="map" style="height: 450px; width: 100%;"></div>

<?php
function distance($lat1, $lon1, $lat2, $lon2, $unit) {
  if (($lat1 == $lat2) && ($lon1 == $lon2)) {
    return 0;
  }
  else {
    $theta = $lon1 - $lon2;
    $dist = sin(deg2rad($lat1)) * sin(deg2rad($lat2)) +  cos(deg2rad($lat1)) * cos(deg2rad($lat2)) * cos(deg2rad($theta));
    $dist = acos($dist);
    $dist = rad2deg($dist);
    $miles = $dist * 60 * 1.1515;
    $unit = strtoupper($unit);

    if ($unit == "K") {
      return ($miles * 1.609344);
    } else if ($unit == "N") {
      return ($miles * 0.8684);
    } else {
      return $miles;
    }
  }
}

echo distance(32.9697, -96.80322, 29.46786, -98.53506, "M") . " Miles<br>";
echo distance(32.9697, -96.80322, 29.46786, -98.53506, "K") . " Kilometers<br>";
echo distance(32.9697, -96.80322, 29.46786, -98.53506, "N") . " Nautical Miles<br>";
?>

<!--end of maps-->

            <div class="row align-items-center mb-4">
              <div class="col-md-6">
                <h2 class="mb-0">
                  <i class="fas fa-map-marker-alt text-danger me-2"></i>
                  Discover the latest new properties
                </h2>
              </div>
              <div class="col-md-6 text-md-end">
                <a href="#" class="btn btn-outline-danger">Advanced search →</a>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Address</th>
                    <th>Property type</th>
                    <th>Price</th>
                    <th>Bedrooms</th>
                    <th>Baths</th>
                  </tr>
                </thead>
                <!-- FIXME: pull data from db with js-->
                <tbody>
                  <tr>
                    <td>
                      <i class="fas fa-map-marker-alt text-danger me-2"></i
                      >Bacum Tulum, Region 11, Tulum, Quintana Roo
                    </td>
                    <td>Residential</td>
                    <td class="text-danger">$199,000</td>
                    <td><i class="fas fa-bed me-2"></i>2</td>
                    <td><i class="fas fa-bath me-2"></i>2</td>
                  </tr>
                  <tr>
                    <td>
                      <i class="fas fa-map-marker-alt text-danger me-2"></i>1885
                      Rue DeChantal, Sainte-Foy/Sillery/Cap-Rouge (Québec),
                      Québec
                    </td>
                    <td>Residential</td>
                    <td class="text-danger">$345,000</td>
                    <td><i class="fas fa-bed me-2"></i>3</td>
                    <td><i class="fas fa-bath me-2"></i>1</td>
                  </tr>
                  <tr>
                    <td>
                      <i class="fas fa-map-marker-alt text-danger me-2"></i>66
                      Rue Charles-Yelle, La Pocatière, Québec
                    </td>
                    <td>Residential</td>
                    <td class="text-danger">$658,000</td>
                    <td><i class="fas fa-bed me-2"></i>3</td>
                    <td><i class="fas fa-bath me-2"></i>2</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="text-white py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h2>Newsletter</h2>
            <p>
              Sign up to receive blog posts related to the real estate world.
            </p>
            <form class="newsletter-form">
              <div class="input-group mb-3">
                <!-- more js... -->
                <input
                  type="email"
                  class="form-control"
                  placeholder="Email address"
                  aria-label="Email address"
                />
                <button class="btn btn-outline-light" type="submit">→</button>
              </div>
            </form>
          </div>
          <div class="col-md-6">
            <div class="row">
              <div class="col-md-4">
                <h5>Quick Links</h5>
                <ul class="list-unstyled">
                  <li><a href="#" class="text-danger">Home</a></li>
                  <li><a href="#">Properties</a></li>
                  <li><a href="#">La Collection RE/MAX</a></li>
                  <li><a href="#">RE/MAX Commercial</a></li>
                  <li><a href="#">Brokers</a></li>
                </ul>
              </div>
              <div class="col-md-4">
                <h5>&nbsp;</h5>
                <ul class="list-unstyled">
                  <li><a href="#">Regions</a></li>
                  <li><a href="#">Blog</a></li>
                  <li><a href="#">Programs</a></li>
                  <li><a href="#">Careers</a></li>
                  <li><a href="#">Contact us</a></li>
                </ul>
              </div>
              <div class="col-md-4">
                <h5>&nbsp;</h5>
                <ul class="list-unstyled">
                  <li><a href="#">Mon RE/MAX</a></li>
                  <li><a href="#">RE/MAX Global</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <hr class="my-4" />
        <div class="row align-items-center">
          <div class="col-md-6 text-center">
            <a href="#" class="text-white me-3">Privacy policy</a>
            <a href="#" class="text-white me-3">Terms of use</a>
            <a href="#" class="text-white">Management of cookie consents</a>
          </div>
          <div class="col-md-6 text-center">
            <a href="#" class="text-white me-3"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" class="text-white me-3"
              ><i class="fab fa-twitter"></i
            ></a>
            <a href="#" class="text-white"
              ><i class="fab fa-linkedin-in"></i
            ></a>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  </body>

  <script>
// TODO: insert actual properties from DB
const properties = [
  { id: 1, lat: 45.5051, lng: -73.5615, address: "1234 Rue Sainte-Catherine O, Montreal" },
  { id: 2, lat: 45.5098, lng: -73.5730, address: "5678 Boulevard de Maisonneuve O, Montreal" },
  { id: 3, lat: 45.5155, lng: -73.5649, address: "9101 Avenue du Parc, Montreal" }
];

//testing user postal code
const userPostalCode = 'H2X 1Y4';

// get user postal code
//const userPostalCode = '<?php echo isset($_SESSION["postal_code"]) ? $_SESSION["postal_code"] : "H2X 1Y4"; ?>'; // Example postal code

let map;

function initMap() {
  // Montreal is the default location
  const initialLocation = { lat: 45.5088, lng: -73.5673 };

  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 12,
    center: initialLocation,
  });

  // if session is active, display the user's location
  if (userPostalCode) {
    getLocationFromPostalCode(userPostalCode, (userLat, userLng) => {
      const userLocation = { lat: userLat, lng: userLng };

      // set user location marker on map
      new google.maps.Marker({
        position: userLocation,
        map: map,
        title: "Your Location",
      });

      // add property markers and calculate distances
      properties.forEach(property => {
        const propertyLocation = { lat: property.lat, lng: property.lng };

        // mark each property
        new google.maps.Marker({
          position: propertyLocation,
          map: map,
          title: property.address,
        });

        // calculate distance
        const distance = google.maps.geometry.spherical.computeDistanceBetween(
          new google.maps.LatLng(userLocation),
          new google.maps.LatLng(propertyLocation)
        );

        const distanceInKm = (distance / 1000).toFixed(2);
        document.getElementById("distance").innerHTML += `
          <p>Distance from your location to ${property.address}: ${distanceInKm} km</p>
        `;
      });
    });
  } else {
    // if no session is active, only display the property markers
    properties.forEach(property => {
      const propertyLocation = { lat: property.lat, lng: property.lng };

      // mark each property
      new google.maps.Marker({
        position: propertyLocation,
        map: map,
        title: property.address,
      });
    });
  }
}

// using Geocoding API for lat/long coordinates
function getLocationFromPostalCode(postalCode, callback) {
  const geocoder = new google.maps.Geocoder();
  geocoder.geocode({ address: postalCode }, (results, status) => {
    if (status === 'OK') {
      const userLocation = results[0].geometry.location;
      callback(userLocation.lat(), userLocation.lng());
    } else {
      console.error('Geocode was not successful: ' + status);
    }
  });
}

// Inside initMap(), we are looping through the properties
properties.forEach(property => {
  const propertyLocation = { lat: property.lat, lng: property.lng };

  // mark each property
  const propertyMarker = new google.maps.Marker({
    position: propertyLocation,
    map: map,
    title: property.address,
  });

  // Create an InfoWindow with basic information
  const infoWindowContent = `
    <div>
      <h3>${property.address}</h3>
      <p>Property Type: Residential</p>
      <p>Price: $500,000</p>
    </div>
  `;
  
  const infoWindow = new google.maps.InfoWindow({
    content: infoWindowContent,
  });

  // Add a click event listener to the marker
  propertyMarker.addListener("click", () => {
    infoWindow.open(map, propertyMarker);
  });
});

</script>
</body>
</html>